!function o(i,n,a){function s(l,e){if(!n[l]){if(!i[l]){var t="function"==typeof require&&require;if(!e&&t)return t(l,!0);if(r)return r(l,!0);throw(t=new Error("Cannot find module '"+l+"'")).code="MODULE_NOT_FOUND",t}t=n[l]={exports:{}},i[l][0].call(t.exports,function(e){return s(i[l][1][e]||e)},t,t.exports,o,i,n,a)}return n[l].exports}for(var r="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,l,t){angular.module("bulibUnpaywall",[]).controller("unpaywallController",["$http","$injector",function(i,e){var n=this,l={};e.modules,e.has("unpaywallConfig")&&(l=e.get("unpaywallConfig")),e.has("primoExploreUnpaywallStudioConfig")&&(l=e.get("primoExploreUnpaywallStudioConfig")),n.email=l.email||"primo-explore-unpaywall@npmjs.com",n.logToConsole=!Object.keys(l).includes("logToConsole")||l.logToConsole,n.publishEvents=!!Object.keys(l).includes("publishEvents")&&l.publishEvents,n.showVersionLabel=!!Object.keys(l).includes("showVersionLabel")&&l.showVersionLabel,n.showDebugTable=!!Object.keys(l).includes("showDebugTable")&&l.showDebugTable,n.showOnResultsPage=!Object.keys(l).includes("showOnResultsPage")||l.showOnResultsPage,n.overrideOACheck=!!Object.keys(l).includes("overrideOACheck")&&l.overrideOACheck,n.logEvent=l.logEvent||function(e,l,t){window.ga&&window.ga("send","event",e,l,t)},n.labelText=Object.keys(l).includes("labelText")?l.labelText:null,n.imageUrl=Object.keys(l).includes("imageUrl")?l.imageUrl:null,n.imageStyle=Object.keys(l).includes("imageStyle")?l.imageStyle:"height: 24px; vertical-align: bottom; padding-right: 5px;",n.logMessageToConsole=function(e){n.logToConsole&&console.log("bulib-unpaywall) "+e)},n.logEventToAnalytics=function(e,l,t){n.logMessageToConsole("triggering '"+e+"."+l+"' event [publish="+n.publishEvents+"]."),n.publishEvents&&n.logEvent(e,l,t)},n.trackLinkClick=function(e){n.logMessageToConsole("unpaywall link used for doi: "+e),n.logEventToAnalytics("unpaywall","usage",n.listOrFullViewLabel)},n.$postLink=function(){n.parentCtrl=n.prmSearchResultAvailabilityLine;var e=n.parentCtrl.result,l=this.parentCtrl.isFullView||this.parentCtrl.isOverlayFullView;n.listOrFullViewLabel=l?"full":"list",n.show=l||n.showOnResultsPage;try{var t,o=e.pnx.addata;o&&(this.doi=o.hasOwnProperty("doi")?o.doi[0]:null,this.is_oa=o.hasOwnProperty("oa")),this.doi&&(!this.is_oa||n.overrideOACheck)&&n.show&&(n.logEventToAnalytics("unpaywall","api-call",n.listOrFullViewLabel),t="https://api.oadoi.org/v2/"+n.doi+"?email="+n.email,n.logMessageToConsole("-> making 'api-call' to "+t),i.get(encodeURI(t)).then(function(e){e=e.data.best_oa_location;e&&(n.best_oa_link=e.url||"",n.logMessageToConsole("successfully acquired a 'best_oa_location' for doi '"+n.doi+"' at url: "+n.best_oa_link),n.logEventToAnalytics("unpaywall","api-success",n.listOrFullViewLabel),(e=e.version.toLowerCase()||"").includes("publish")?n.best_oa_version="":n.best_oa_version=e.includes("submit")?"Submitted":"Accepted")},function(e){n.logMessageToConsole("[error status: "+e.status+"] error calling unpaywall API: "+e.statusText)}))}catch(e){n.logMessageToConsole("error caught in unpaywallController: "+e.message)}}}]).component("bulibUnpaywall",{require:{prmSearchResultAvailabilityLine:"^prmSearchResultAvailabilityLine"},template:'      <unpaywall ng-if="$ctrl.show">        <div layout="flex" ng-if="$ctrl.best_oa_link" class="layout-row" style="margin-top: 5px;">          <a ng-click="$ctrl.trackLinkClick($ctrl.doi)" target="_blank" href="{{$ctrl.best_oa_link}}"            style="margin-left: 3px; margin-top: 3px;" rel="noreferrer">                        <img ng-if="$ctrl.imageUrl" src="{{$ctrl.imageUrl}}" alt="unpaywall logo" style="{{$ctrl.imageStyle}}">            <prm-icon ng-hide="$ctrl.imageUrl" icon-type="svg" svg-icon-set="action" icon-definition="ic_lock_open_24px" style="color: #f68212;"></prm-icon>                        <span ng-if="$ctrl.labelText">{{$ctrl.labelText}}</span>            <span ng-hide="$ctrl.labelText"><strong>Open Access</strong> available via unpaywall</span>                        <span ng-if="$ctrl.showVersionLabel && $ctrl.best_oa_version">&nbsp({{$ctrl.best_oa_version}} version)</span>            <prm-icon external-link icon-type="svg" svg-icon-set="primo-ui" icon-definition="open-in-new"></prm-icon>          </a>        </div>        <div ng-if="$ctrl.showDebugTable" class="layout-row">          <table>            <tr><td><strong>doi</strong></td><td>{{$ctrl.doi}}</td></tr>            <tr><td><strong>is_OA</strong></td><td>{{$ctrl.is_oa}}</td>            <tr><td><strong>best_oa_link</strong></td><td>{{$ctrl.best_oa_link}}</td></tr>            <tr><td><strong>best_oa_version</strong></td><td>{{$ctrl.best_oa_version}}</td></tr>          </table>        </div>      </unpaywall>',controller:"unpaywallController"})},{}],2:[function(e,l,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default="<bulib-unpaywall></bulib-unpaywall>"},{}],3:[function(e,l,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={email:"jay.colbert@unh.edu",showOnResultsPage:!0,overrideOACheck:!1,showVersionLabel:!0,showDebugTable:!1,publishEvents:!1,labelText:"View Open Access Version via Unpaywall",imageUrl:"https://upload.wikimedia.org/wikipedia/commons/archive/2/25/20181007070735%21Open_Access_logo_PLoS_white.svg",imageStyle:"width: 20px; padding-right:5px; vertical-align: middle;"}},{}],4:[function(e,l,t){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={template:((o=e("../components/unpaywall.component"))&&o.__esModule?o:{default:o}).default};t.default=i},{"../components/unpaywall.component":2}],5:[function(e,l,t){"use strict";e("primo-explore-unpaywall");var o=i(e("./components/unpaywall.config")),e=i(e("./directives/prmSearchResultAvailabilityLineAfter.directive"));function i(e){return e&&e.__esModule?e:{default:e}}angular.module("viewCustom",["angularLoad","bulibUnpaywall"]).constant("unpaywallConfig",o.default).component("prmSearchResultAvailabilityLineAfter",e.default)},{"./components/unpaywall.config":3,"./directives/prmSearchResultAvailabilityLineAfter.directive":4,"primo-explore-unpaywall":1}]},{},[5]);
//# sourceMappingURL=custom.js.map
