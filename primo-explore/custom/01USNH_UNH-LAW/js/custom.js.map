{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/primo-explore-unpaywall/src/unpaywall.module.js","primo-explore/custom/01USNH_UNH-LAW/js/components/unpaywall.component.js","primo-explore/custom/01USNH_UNH-LAW/js/components/unpaywall.config.js","primo-explore/custom/01USNH_UNH-LAW/js/directives/prmSearchResultAvailabilityLineAfter.directive.js","primo-explore/custom/01USNH_UNH-LAW/js/main.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","angular","controller","$http","$injector","self","this","unpaywallConfig","modules","has","get","email","logToConsole","Object","keys","includes","publishEvents","showVersionLabel","showDebugTable","showOnResultsPage","overrideOACheck","logEvent","category","action","label","window","ga","labelText","imageUrl","imageStyle","logMessageToConsole","message","console","log","logEventToAnalytics","trackLinkClick","doi","listOrFullViewLabel","$postLink","parentCtrl","prmSearchResultAvailabilityLine","item","result","onFullView","isFullView","isOverlayFullView","show","apiUrl","addata","pnx","hasOwnProperty","is_oa","encodeURI","then","successResponse","best_oa_location","data","best_oa_link","url","best_oa_version","version","toLowerCase","errorResponse","status","statusText","component","template","PRMSearchResultAvailabilityLineAfterDirective","default","_unpaywall","_interopRequireDefault","_prmSearchResultAvailabilityLineAfter","constant"],"mappings":"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","file":"custom.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","angular.module('bulibUnpaywall', [])\n  .controller('unpaywallController', ['$http', '$injector',\n    function($http, $injector) {\n      var self = this;  // 'this' changes scope inside of the $http.get(). 'self' is easier to track/trace\n\n      var LOG_CONFIG_DISCOVERY = false;\n\n      var logEventToGoogleAnalytics = function(category, action, label){\n        if(window.ga){ window.ga('send', 'event', category, action, label); }\n      }\n\n      // obtain custom configuration information from 'unpaywallConfig' or primo-studio constant\n      var unpaywallConfig = {};\n      if ($injector.modules && LOG_CONFIG_DISCOVERY) {\n        console.log($injector.modules);\n      }\n      if ($injector.has('unpaywallConfig')) {\n        if (LOG_CONFIG_DISCOVERY) { console.log(\"'unpaywallConfig' found: \"); }\n        unpaywallConfig = $injector.get('unpaywallConfig');\n      }\n      if ($injector.has('primoExploreUnpaywallStudioConfig')) {\n        if (LOG_CONFIG_DISCOVERY) { console.log(\"'primoExploreUnpaywallStudioConfig' found: \"); }\n        unpaywallConfig = $injector.get('primoExploreUnpaywallStudioConfig');\n      }\n      if (LOG_CONFIG_DISCOVERY) { console.log(unpaywallConfig); }\n\n      // provide 'unpaywall' organization with default value including some context that it's from us (for rate-limiting)\n      self.email = unpaywallConfig.email || \"primo-explore-unpaywall@npmjs.com\";\n\n      // provide additional customization options (with defaults)\n      self.logToConsole = (Object.keys(unpaywallConfig).includes(\"logToConsole\")) ? unpaywallConfig.logToConsole : true;\n      self.publishEvents = (Object.keys(unpaywallConfig).includes(\"publishEvents\")) ? unpaywallConfig.publishEvents : false;\n      self.showVersionLabel = (Object.keys(unpaywallConfig).includes(\"showVersionLabel\")) ? unpaywallConfig.showVersionLabel : false;\n      self.showDebugTable = (Object.keys(unpaywallConfig).includes(\"showDebugTable\")) ? unpaywallConfig.showDebugTable : false;\n      self.showOnResultsPage = (Object.keys(unpaywallConfig).includes(\"showOnResultsPage\")) ? unpaywallConfig.showOnResultsPage : true;\n      self.overrideOACheck = (Object.keys(unpaywallConfig).includes(\"overrideOACheck\")) ? unpaywallConfig.overrideOACheck : false;\n      self.logEvent = unpaywallConfig.logEvent || logEventToGoogleAnalytics;\n\n      // customize UI/UX\n      self.labelText = (Object.keys(unpaywallConfig).includes(\"labelText\")) ? unpaywallConfig.labelText : null;\n      self.imageUrl  = (Object.keys(unpaywallConfig).includes(\"imageUrl\")) ? unpaywallConfig.imageUrl : null;\n      self.imageStyle = (Object.keys(unpaywallConfig).includes(\"imageStyle\")) ? unpaywallConfig.imageStyle : \"height: 24px; vertical-align: bottom; padding-right: 5px;\";\n      \n      // conditionally log to the console\n      self.logMessageToConsole = function (message) {\n        if (self.logToConsole) { console.log(\"bulib-unpaywall) \" + message); }\n      }\n\n      // conditionally call customized 'logEvent'\n      self.logEventToAnalytics = function (category, action, label) {\n        self.logMessageToConsole(\"triggering '\" + category + \".\" + action + \"' event [publish=\" + self.publishEvents + \"].\");\n        if (self.publishEvents) { self.logEvent(category, action, label); }\n      }\n\n      // ng-click response that logs data to google analytics\n      self.trackLinkClick = function (doi) {\n        self.logMessageToConsole(\"unpaywall link used for doi: \" + doi);\n        self.logEventToAnalytics(\"unpaywall\", \"usage\", self.listOrFullViewLabel);\n      };\n\n      self.$postLink = function(){\n        self.parentCtrl = self.prmSearchResultAvailabilityLine\n        var item = self.parentCtrl.result;  // item data is stored in 'prmSearchResultAvailability' (its parent)\n\n        // obtain contextual info on whether you're on the result list of the full item view\n        var onFullView = this.parentCtrl.isFullView || this.parentCtrl.isOverlayFullView;\n        self.listOrFullViewLabel = onFullView ? 'full' : 'list';\n        self.show = onFullView || self.showOnResultsPage;\n\n        try {\n          // obtain doi and open access information from the item PNX (metadata)\n          var addata = item.pnx.addata;\n          if (addata) {\n            this.doi = addata.hasOwnProperty(\"doi\") ? addata.doi[0] : null; //default to first doi (list)\n            this.is_oa = addata.hasOwnProperty(\"oa\"); //true if property is present at all (regardless of value)\n          }\n\n          // if there's a doi and it's not already open access, ask the oadoi.org for an OA link\n          if (this.doi && (!this.is_oa || self.overrideOACheck) && self.show) {\n            self.logEventToAnalytics('unpaywall', 'api-call', self.listOrFullViewLabel);\n\n            // make the actual call to unpaywall API\n            var apiUrl = \"https://api.oadoi.org/v2/\" + self.doi + \"?email=\" + self.email;\n            self.logMessageToConsole(\"-> making 'api-call' to \" + apiUrl);\n            $http.get(encodeURI(apiUrl)).then(\n              function (successResponse) {\n                // if there is a \"best open access location\", save it so it can be used in the template above\n                var best_oa_location = successResponse.data.best_oa_location;\n                if (!best_oa_location) {\n                  return; // can't get what we want from unpaywall. returning with nothing\n                }\n\n                // get the \"best\" content link from this \"best_oa_location\"\n                self.best_oa_link = best_oa_location.url || \"\";\n                self.logMessageToConsole(\"successfully acquired a 'best_oa_location' for doi '\" + self.doi + \"' at url: \" + self.best_oa_link);\n                self.logEventToAnalytics('unpaywall', 'api-success', self.listOrFullViewLabel);\n\n                // optionally display whether the link is to a published, submitted, or accepted version\n                var best_oa_version = best_oa_location.version.toLowerCase() || \"\";\n                if (best_oa_version.includes(\"publish\")) {\n                  self.best_oa_version = \"\";  // users should assume it's the 'published' version without it being clarified in the UI\n                } else {\n                  self.best_oa_version = (best_oa_version.includes(\"submit\")) ? \"Submitted\" : \"Accepted\";\n                }\n              }, function (errorResponse) {\n                self.logMessageToConsole(\"[error status: \" + errorResponse.status + \"] error calling unpaywall API: \" + errorResponse.statusText);\n              }\n            );\n          }\n\n        } catch (e) {\n          self.logMessageToConsole(\"error caught in unpaywallController: \" + e.message);\n        }\n      }\n\n    }\n  ])\n  .component('bulibUnpaywall', {\n    require: {\n      prmSearchResultAvailabilityLine: '^prmSearchResultAvailabilityLine'\n    },\n    template: '\\\n      <unpaywall ng-if=\"$ctrl.show\">\\\n        <div layout=\"flex\" ng-if=\"$ctrl.best_oa_link\" class=\"layout-row\" style=\"margin-top: 5px;\">\\\n          <a ng-click=\"$ctrl.trackLinkClick($ctrl.doi)\" target=\"_blank\" href=\"{{$ctrl.best_oa_link}}\"\\\n            style=\"margin-left: 3px; margin-top: 3px;\" rel=\"noreferrer\">\\\n            \\\n            <img ng-if=\"$ctrl.imageUrl\" src=\"{{$ctrl.imageUrl}}\" alt=\"unpaywall logo\" style=\"{{$ctrl.imageStyle}}\">\\\n            <prm-icon ng-hide=\"$ctrl.imageUrl\" icon-type=\"svg\" svg-icon-set=\"action\" icon-definition=\"ic_lock_open_24px\" style=\"color: #f68212;\"></prm-icon>\\\n            \\\n            <span ng-if=\"$ctrl.labelText\">{{$ctrl.labelText}}</span>\\\n            <span ng-hide=\"$ctrl.labelText\"><strong>Open Access</strong> available via unpaywall</span>\\\n            \\\n            <span ng-if=\"$ctrl.showVersionLabel && $ctrl.best_oa_version\">&nbsp({{$ctrl.best_oa_version}} version)</span>\\\n            <prm-icon external-link icon-type=\"svg\" svg-icon-set=\"primo-ui\" icon-definition=\"open-in-new\"></prm-icon>\\\n          </a>\\\n        </div>\\\n        <div ng-if=\"$ctrl.showDebugTable\" class=\"layout-row\">\\\n          <table>\\\n            <tr><td><strong>doi</strong></td><td>{{$ctrl.doi}}</td></tr>\\\n            <tr><td><strong>is_OA</strong></td><td>{{$ctrl.is_oa}}</td>\\\n            <tr><td><strong>best_oa_link</strong></td><td>{{$ctrl.best_oa_link}}</td></tr>\\\n            <tr><td><strong>best_oa_version</strong></td><td>{{$ctrl.best_oa_version}}</td></tr>\\\n          </table>\\\n        </div>\\\n      </unpaywall>',\n    controller: 'unpaywallController'\n  });","const UnpaywallComponent = `<bulib-unpaywall></bulib-unpaywall>`;\n\nexport default UnpaywallComponent;\n","const UnpaywallConfig = {\n  email: \"jay.colbert@unh.edu\",\n  showOnResultsPage: true,\n  overrideOACheck: false,\n  showVersionLabel: true,\n  showDebugTable: false,\n  publishEvents: false,\n  labelText: \"View Open Access Version via Unpaywall\",\n  imageUrl:\n    \"https://upload.wikimedia.org/wikipedia/commons/archive/2/25/20181007070735%21Open_Access_logo_PLoS_white.svg\",\n  imageStyle: \"width: 20px; padding-right:5px; vertical-align: middle;\",\n};\n\nexport default UnpaywallConfig;\n","import UnpaywallComponent from \"../components/unpaywall.component\";\n\nconst PRMSearchResultAvailabilityLineAfterDirective = {\n  template: UnpaywallComponent,\n};\n\nexport default PRMSearchResultAvailabilityLineAfterDirective;\n","import \"primo-explore-unpaywall\";\n\nimport UnpaywallConfig from \"./components/unpaywall.config\";\nimport PRMSearchResultAvailabilityLineAfterDirective from \"./directives/prmSearchResultAvailabilityLineAfter.directive\";\n\n// eslint-disable-next-line no-undef\nconst app = angular.module(\"viewCustom\", [\"angularLoad\", \"bulibUnpaywall\"]);\n\napp\n  .constant(\"unpaywallConfig\", UnpaywallConfig)\n  .component(\n    \"prmSearchResultAvailabilityLineAfter\",\n    PRMSearchResultAvailabilityLineAfterDirective\n  );\n"]}